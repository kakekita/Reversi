<!doctype html>
<html>
<head>
  <title>オセロ</title>
  <style>
    .box {
      background-image: linear-gradient(0deg, transparent calc(100% - 1px), #def6ff calc(100% - 1px)),
                        linear-gradient(90deg, transparent calc(100% - 1px), #def6ff calc(100% - 1px));
      background-size: 75px 75px;
      background-repeat: repeat;
      background-position: top left;
      background-color: green;
      border: 1px solid black;
    }
    
    .bsize {
      width: 600px;
      height: 600px;
    } 
  </style>
</head>
<body>
<div id="plate" class="box bsize">
  <canvas id="canvas" width="600" height="600"></canvas>
</div>
<script>
  var canvas = document.getElementById("canvas");
  var ct = canvas.getContext("2d");
  var plate = document.getElementById("plate");
  var bd = [];
  for(var i = 0;i < 8;i++) {
    bd.push([0,0,0,0,0,0,0,0]);
  }
  bd[3][3] = 101;
  bd[3][4] = 201;
  bd[4][3] = 201;
  bd[4][4] = 101;
  repaint(bd);
  var turn = 1;
  var ps = [1,2];
  var dir = [[-1,0],[-1,1],[0,1],[1,1],[1,0],[1,-1],[0,-1],[-1,-1]];//[ y , x ]
  canvas.addEventListener("click",e=>{
    const rect = e.target.getBoundingClientRect();
    const viewX = e.clientX - rect.left;
    const viewY = e.clientY - rect.top;
    const scaleWidth =  canvas.clientWidth / canvas.width
    const scaleHeight =  canvas.clientHeight / canvas.height;
    const canvasX = Math.floor( viewX / scaleWidth );
    const canvasY = Math.floor( viewY / scaleHeight );
    var x = Math.floor(canvasX/75);
    var y = Math.floor(canvasY/75);
    if(bd[y][x] == 0) {
      var aGrids = isAround(bd,y,x);
      var retXYV = [];
      var st = false;
      for(var g = 0;g < aGrids.length;g++) {
        alert(aGrids[g].toString())
        var n = 1;
        var turn2 = 0;
        if(turn == 1) {
          turn2 = 2;
        }else if(turn == 2) {
          turn2 = 1;
        }
        var rtmp = [];
        while(n < aGrids[g].length&&turn2*100 < aGrids[g][n]&&aGrids[g][n] <= turn2*100+15) {
          rtmp.push([y+dir[g][0]*n,x+dir[g][1]*n,changeCol(aGrids[g][n])]);
          n++;
        }
        if(n < aGrids[g].length&&turn*100 < aGrids[g][n]&&aGrids[g][n] <= turn*100+15) {
          for(var rt of rtmp) {
            retXYV.push(rt);
            st = true;
          }
        }
      }
      if(st) {
        alert(retXYV.length);
        bd[y][x] = turn*100+1
        for(var r = 0;r < retXYV.length;r++) {
          bd[retXYV[r][0]][retXYV[r][1]] = retXYV[r][2];
        }
        repaint(bd);

        if(trun == 1) {
          turn = 2;
        }else if(turn == 2) {
          turn = 1;
        }
      }
    }
  });
  
  function changeCol(n) {
    if(200 < n&&n <= 215) {
      n -= 100;
    }else if(100 < n&&n <= 115) {
      n += 100;
    }
    return n;
  }
  
  function isAround(arr,y,x) {
    var tmp = [];
    for(var d of dir) {
      var y2 = y;
      var x2 = x;
      var t = [];
      while(0 <= y2&&y2 < 8&&0 <= x2&&x2 < 8) {
        t.push(arr[y2][x2]);
        y2 += d[0];
        x2 += d[1];
      }
      tmp.push(t);
    }
    return tmp;
  }
  
  function repaint(arr) {
    for(var dy = 0;dy < arr.length;dy++) {
      for(var dx = 0;dx < arr[dy].length;dx++) {
        if(arr[dy][dx] != 0) {
          ct.beginPath();
          ct.arc(dx*75+75/2+2,dy*75+75/2+2,75/2-2,0, Math.PI * 2, true);
          if(arr[dy][dx] >= 200) {
            ct.fillStyle = "black";
          } else if(arr[dy][dx] >= 100) {
            ct.fillStyle = "white";
          }
          ct.fill();
        }
      }
    }
  }

</script>
</body>
</html>
